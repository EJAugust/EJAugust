{let e="HTMLElement"in globalThis?"CLIENT":"SERVER",t=(...t)=>(a&&(console.groupCollapsed(e,...t),console.trace(...t),console.groupEnd()),t.pop()),a=!0,r={"https://dev.core.parts/globalThis?":"operation=globalThis","https://dev.core.parts/document?":"operation=access&a=globalThis&b=data:,document","https://dev.core.parts/body?":"operation=access&a=document&b=data:,body","https://dev.core.parts/404/?":"manifest=manifest&layout=layout","https://dev.core.parts/404/crumbs?":"layout=layout","https://dev.core.parts/404/header?":"layout=layout","https://dev.core.parts/404/footer?":"layout=layout","https://dev.core.parts/404/manifest?":"operation=parse/list&datastring=data:,https://dev.core.parts/404/crumbs%20https://dev.core.parts/404/header%20https://dev.core.parts/404/footer","https://dev.core.parts/404/layout?":"operation=math/add&a=data:,:host&b=data:base64,"+btoa("{ background: green }"),"https://dev.core.parts/operations/globalThis?":"expression=data:text/javascript;base64,"+btoa("globalThis"),"https://dev.core.parts/operations/assign?":"a=../globalThis&b=data:,hello&c=data:,world&expression=data:text/javascript;base64,"+btoa("a[b]=c"),"https://dev.core.parts/operations/access?":"a=data:operation=parse/integer,6&b=data:operation=parse/integer,3&expression=data:text/javascript;base64,"+btoa("a[b]"),"https://dev.core.parts/operations/math/add?":"a=data:operation=parse/integer,1&b=data:operation=parse/integer,2&expression=data:text/javascript;base64,"+btoa("a+b"),"https://dev.core.parts/operations/math/power?":"a=data:operation=parse/integer,2&b=data:operation=parse/integer,8&expression=data:text/javascript;base64,"+btoa("a**b"),"https://dev.core.parts/operations/math/log?":"a=data:operation=parse/integer,8&b=data:operation=parse/integer,2&expression=data:text/javascript;base64,"+btoa("Math.log(a)/Math.log(b)"),"https://dev.core.parts/operations/math/subtract?":"a=data:operation=parse/integer,3&b=data:operation=parse/integer,2&expression=data:text/javascript;base64,"+btoa("a-b"),"https://dev.core.parts/operations/math/multiply?":"a=data:operation=parse/integer,2&b=data:operation=parse/integer,3&expression=data:text/javascript;base64,"+btoa("a*b"),"https://dev.core.parts/operations/math/divide?":"a=data:operation=parse/integer,6&b=data:operation=parse/integer,3&expression=data:text/javascript;base64,"+btoa("a/b"),"https://dev.core.parts/operations/parse/integer?":"datastring=data:,3.14&radix=data:,10&expression=data:text/javascript;base64,"+btoa("parseInt(datastring,parseInt(radix))"),"https://dev.core.parts/operations/parse/float?":"datastring=data:,3.14&expression=data:text/javascript;base64,"+btoa("parseFloat(datastring)"),"https://dev.core.parts/operations/parse/list?":"datastring=data:,3%2014&delimiter=data:,%20&expression=data:text/javascript;base64,"+btoa("datastring.split(delimiter)"),"https://dev.core.parts/operations/parse/json?":"datastring=data:,3.14&expression=data:text/javascript;base64,"+btoa("JSON.parse(datastring)")},s={},o={},i=e=>{let a=e.expression,r=h(a);if(!r)throw`MakeOperationError: Missing or empty expression (${a})`;delete e.expression;let s=Object.keys(e);for(let o of s){if(!/^(?:[a-zA-Z$_]+[0-9]*)+$/.test(o))throw`MakeOperationError: '${o}' is not a valid parameter name for expression (${a})`;if(["instanceof","typeof","break","do","new","var","case","else","return","void","catch","finally","continue","for","switch","while","this","with","debugger","function","throw","default","if","try","delete","in"].includes(o))throw`MakeOperationError: '${o}' cannot be used as a parameter name for expression (${a})`}let i=t("operation",Function("$_EXPRESSION","$_DEFAULT","$_INPUT",...s,"return "+r));return t=>i({BODY:r,REQUEST_URL:a},e,t,...s.map(a=>h(t?.[a]??e[a])))},n=(e,t="https://dev.core.parts/")=>{let a={};for(let[r,s]of e){if(void 0===s)throw`ParamObjectError: parameter "${r}" has undefined value URL which is not allowed. ${t} `;if(r.startsWith("...")){let o=h(new URL(r.slice(3)+"#parameters",t));Object.assign(a,o);continue}let i="operation"===r?"https://dev.core.parts/operations/":t;s.startsWith("data:")?a[r]=s:a[r]=new URL(s,i).href}return a},p=(e,t)=>{e.startsWith("data:")||t.startsWith("data:")||(e in o||(o[e]=new Set),o[e].add(t))},d=e=>{let t=e.operation,a=h(t);if(!a)throw`ApplyError: Missing operation. (${t})`;return delete e.operation,a(e)},h=(e,a)=>{if(!a&&e in r)return t(e,"y (cache)",r[e]);if(c--<=0)throw`MoneyError: Please get more money, Eric. ${e}`;let{protocol:s,origin:o,pathname:h,searchParams:l,hash:u}=new URL(e),f=o+h;if(0!==l.size)throw`GetError: Request parameters are not yet supported. (${e})`;switch(s){case"data:":{let[,,b="charset=US-ASCII",g,m]=e.match(/^data:([^;/,]+\/[^;/,]+)?;?((?:[^;,]+=[^;,]+)*)(;?base64)?,(.*)$/),v=b.includes(";")?b.split(";").map(e=>e.split("=")):[],w=n(v);if("operation"in w){if("datastring"in w)throw`GetError: The 'datastring' parameter name in reserved in data URIs. ${e}`;return w.datastring="data:"+(g??"")+","+m,r[e]=t("operation (datastring)",d(w))}return r[e]=t("datastring",g?atob(m):m)}case"https:":{if(!(f+"?" in r))return t(`404 undefined. (${e})`,void 0);let $=f+"?";p($,e);let x=n([...new URL("?"+r[$],f).searchParams.entries()],f);for(let y of Object.values(x))p(y,e);switch(!0){case"#parameters"===u:return r[e]=t("#parameters",x);case"operation"in x:return r[e]=t("operation (any)",d(x));case"expression"in x:return r[e]=i(x);default:return t("fallback, no operation or expression",void 0)}}default:throw`GetError: The requestURL uses an unsupported URI scheme "${s}". (${e})`}},l=e=>{let t=new Set,a=i=>{for(let n of i){if(n in t)continue;let p=r[n],d=n in e?e[n]:h(n,!0);p!==d&&(r[n]=d,n in s&&Object.entries(s[n]).forEach(([e,t])=>t.forEach(t=>t[e]=d))),t.add(n),n in o&&a(o[n])}};a(Object.keys(e))};var c=50;if("CLIENT"===e){let u={},f=["onfocus","onpointerdown","onclick","oncontextmenu","onblur"],b={onkeydown:0,onkeyup:0,onclick:0,onwheel:0,oncontextmenu:0,onpointerdown:0,onpointerup:0,onpointermove:0,ondblclick:0,onfocus:0,onblur:0,layout:1,manifest:1,ondragstart:-1};Object.defineProperties(HTMLElement.prototype,{install:{get(){return(e,t)=>{if(!e)throw TypeError(`install url cannot be ${void 0===e?"undefined":""===e?"an empty string":`"${e}"`} (installing <${this.tagName}> on ${this.incomingChildURL})`);let a=new URL(e,this.url).href,r=a in u?[...u[a]].find(e=>!e.isConnected&&!e.parentNode):void 0;if(void 0===r){let s=a.match(/https:\/\/[^\/]*\/(?:[^\/]*\/)*((?:[a-zA-Z$_]+[0-9]*)+)(?:\/[^\/]*)?$/)?.[1],o=s?s.includes("-")?s:s+"-":"node-";r=document.createElement(o)}t<this.shadow.children.length?this.shadow.insertBefore(r,this.shadow.children[t]):this.shadow.appendChild(r),"url"in r||r.inject(a)}}},inject:{get(){return e=>{if("url"in this)throw TypeError(`cannot inject node twice (injected as ${this.url}, tried to inject as ${e})`);let t=new CSSStyleSheet;Object.defineProperties(this,{url:{value:e,writable:!1,configurable:!1,enumerable:!0},shadow:{value:this.attachShadow({mode:"closed"}),writable:!1,configurable:!1,enumerable:!0},parameters:{value:h(e+"#parameters")??h("https://dev.core.parts/404/#parameters"),writable:!1,configurable:!1,enumerable:!0},layout:{set(e){t.replaceSync(e)}},manifest:{set(e){if(!(e instanceof Array))throw`HTMLElementError: manifest must be a list of URLs. Got type "${typeof e}." (${e}) (${this.url})`;let t=[...this.shadow.children];if(0===e.length){t.forEach(e=>e.remove());return}let a=t.map(e=>e.url);if(a.join(" ")===e.join(" "))return;let r=-1,s,o;for(;a.length&&e.length;)if(r++,(s=a.shift())!==(o=e.shift())){let i=a.findIndex(e=>e===o);-1!==i?(this.shadow.insertBefore(this.shadow.children[r+i+1],this.shadow.children[r]),a.splice(i,1)):this.install(o,r),e.some(e=>e===s)?a.unshift(s):this.shadow.children[r+1].remove()}a.length?a.forEach(()=>this.shadow.children[r+1].remove()):e.length&&e.forEach(e=>this.install(e))}}}),this.shadow.adoptedStyleSheets.push(t),e in u||(u[e]=new Set),u[e].add(this);let a=Object.keys(this.parameters);for(let r in a.some(e=>f.includes(e))&&(this.tabIndex=0),b){let o=this.parameters[r];switch(b[r]){case -1:this[r]=e=>e.preventDefault();break;case 0:if(!a.includes(r))break;this[r]=e=>h(o)?.({event:e});break;case 1:if(!a.includes(r))break;this[r]=h(o),o in s||(s[o]={}),r in s[o]||(s[o][r]=new Set),s[o][r].add(this)}}}}}}),onload=async()=>{let{waiting:e,installing:t,active:a=await new Promise(a=>(e??t).onstatechange=({target:e})=>"activated"===e.state?a(e):0)}=await navigator.serviceWorker.register(location.origin+"/min.js");document.body.inject(location.href),setTimeout(()=>{l({"https://dev.core.parts/404/manifest":["https://dev.core.parts/404/footer","https://dev.core.parts/404/crumbs","https://dev.core.parts/404/header"]})},1e3)}}else onfetch=e=>t({fetch:e.request.url})}